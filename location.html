<!DOCTYPE html>
<html>
    <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

      <!-- vehicle api 必須 : ここから-->
      <script src="http://52.193.125.145:3000/socket.io/socket.io.js"></script>
      <script src="http://52.193.125.145:3000/www/js/vehicleAPI.js"></script>
      <script src="http://52.193.125.145:3000/www/js/vehicleAPI-client.js"></script>
      <!-- vehicle api 必須 : ここまで -->

      <!-- Map -->
	    <script src="http://support.chizumaru.com/aspusers/online_manual/AjaxFramework/3.3.13/lib/Mapple.js" type="text/javascript"></script>
	    <script src="http://support.chizumaru.com/aspusers/online_manual/AjaxFramework/3.3.13/lib/slider.js" type="text/javascript"></script>
	    <script src="http://support.chizumaru.com/aspusers/online_manual/AjaxFramework/3.3.13/lib/scrollmap.js" type="text/javascript"></script>
      <script src="https://code.jquery.com/jquery-2.2.0.min.js"></script>
      <script type="text/javascript" src="./js/ion.sound.min.js"></script>
      <script type="text/javascript" src="./js/app.js"></script>
      <style>
        #map{
            width:500px;
            height:430px;
            position: absolute;
            z-index:-1;
        }
      </style>

      <!-- vehicle api 必須 : ここから-->
      <script>
      </script>
      <!-- vehicle api 必須 : ここまで -->

      <script>
        var map;
        var x=502933;
        var y=128472;
        var w=700;
        var h=500;
        var scl=300;
        var sideOffset = {leftSideOffset: 0, rightSideOffset: 0, topSideOffset: 0, bottomSideOffset: 0};

      window.onload = function () {

      	document.getElementById("connect").addEventListener('click', function(){
          var msg = {"roomID":document.getElementById("WSRoomID").value, "data":"NOT REQUIRED"};
          socket.emit('joinRoom', JSON.stringify(msg));
        });
//        map = new Mapple.SingleMap("map", w, h, x, y, scl, {k1: "kddisou", k2: "2238ader", position: "relative", datum: "tokyo" });
        map = new Mapple.SingleMap("map", w, h, x, y, scl, {k1: "kddisou", k2: "2238ader", position: "relative", datum: "wgs84" });

        var gVehicleSpeed = 0;
        var gEngineSpeed = 0;
        var vehicleSpeedSub = navigator.vehicle.vehicleSpeed.subscribe(function(vehicleSpeed) {
          gVehicleSpeed = Math.floor(vehicleSpeed.speed /1000);
        });
        var engineSpeedSub = navigator.vehicle.engineSpeed.subscribe(function(engineSpeed) {
          gEngineSpeed = Math.floor(engineSpeed.speed /1000);
        });

	        var locationSub = navigator.vehicle.location.subscribe(function(location) {
	        var oldLatitude;
	        var oldLongitude;

	        if(oldLatitude === undefined || oldLongitude === undefined){
	          //初回
	          oldLatitude = location.latitude;
	          oldLongitude = location.longitude;
	        } else if(oldLatitude === location.latitude && oldLongitude === location.longitude) {
	          //前回と位置が同じ : do nothing
	          return;
	        } else {
	          //前回と位置が異なる
	          oldLatitude = location.latitude;
	          oldLongitude = location.longitude;
	        }
//	        addMarker2(gVehicleSpeed, gEngineSpeed, location.latitude, location.longitude);
            map.moveMap(parseFloat(location.longitude*3600), parseFloat(location.latitude*3600), scl, sideOffset);
	      });
	  }
      </script>
    </head>
    <body>
      <div>
        Room ID:<input type=text id="WSRoomID" value="34363bced106"></input><button id="connect">Start</button>
      </div>

      <div id="map"></div>
      <button id="sound">サウンドテスト</button>
    </body>
</html>
